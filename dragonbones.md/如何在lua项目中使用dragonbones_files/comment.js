jQuery(function(){function reply(authorId,commentId,commentBox){var author=MGJS.$(authorId).innerHTML;var insertStr='<a href="#'+commentId+'">@'+author.replace(/\t|\n|\r\n/g,"")+' </a>\n';insertComment(insertStr,commentBox);}
function quote(authorId,commentId,commentBodyId,commentBox){var author=MGJS.$(authorId).innerHTML;var comment=MGJS.$(commentBodyId).innerHTML;var insertStr='<blockquote cite="#'+commentBodyId+'">';insertStr+='\n<strong><a href="#'+commentId+'">'+author.replace(/\t|\n|\r\n/g,"")+'</a> :</strong>';insertStr+=comment.replace(/\t/g,"");insertStr+='</blockquote>\n';insertComment(insertStr,commentBox);}
function insertComment(insertStr,commentBox){if(MGJS.$(commentBox)&&MGJS.$(commentBox).type=='textarea'){var field=MGJS.$(commentBox);}else{alert("The comment box does not exist!");return false;}
if(field.value.replace(/[\r\n]/g,"").indexOf(insertStr.replace(/[\r\n]/g,""))>-1){alert("You've already appended this reply!");return false;}
if(field.value.replace(/\s|\t|\n/g,"")==''){field.value=insertStr;}else{field.value=field.value.replace(/[\n]*$/g,"")+'\n\n'+insertStr;}
field.focus();if(document.selection){var sel=field.createTextRange();sel.moveStart('character',field.value.length);sel.collapse();sel.select();}else if(field.selectionStart||field.selectionStart=='0'){field.selectionStart=field.value.length;field.selectionEnd=field.value.length;}}
window['MGJS_CMT']={};window['MGJS_CMT']['reply']=reply;window['MGJS_CMT']['quote']=quote;});jQuery(function($){var id=/^#comment-/;var at=/^@/;$('#thecomments li p a').each(function(){if($(this).attr('href').match(id)&&$(this).text().match(at)){$(this).addClass('atreply');}});$('.atreply').hover(function(){$($(this).attr('href')).clone().hide().insertAfter($(this).parents('li')).attr('id','').addClass('tip').fadeIn(200);},function(){$('.tip').fadeOut(400,function(){$(this).remove();});});$('.atreply').mousemove(function(e){$('.tip').css({left:(e.clientX+18),top:(e.pageY+18)})});});